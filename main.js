(()=>{"use strict";var e="",t="",n="",r="",o="",c="",a="";function i(e){e.classList.add(o),e.disabled=!0}function u(){Array.from(document.querySelectorAll(t)).forEach((function(e){var t=e.querySelector(n);l(e,t)}))}var l=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(c),n.classList.remove(a),n.textContent=""},s=function(e){var t=Array.from(e.querySelectorAll(n)),u=e.querySelector(r);i(u),t.forEach((function(n){n.addEventListener("input",(function(){(function(e,t){t.validity.valid?l(e,t):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(c),r.textContent=n,r.classList.add(a)}(e,t,t.validationMessage)})(e,n),function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(o),t.disabled=!1):i(t)}(t,u)}))}))},d=document.querySelector(".page");function f(e){e.classList.add("popup_opened"),_()}function v(e){e.classList.remove("popup_opened"),y()}var m=function(e){var t=document.querySelector(".popup_opened");"Escape"===e.key&&v(t)},p=function(e){var t=document.querySelector(".popup_opened");!e.target.classList.contains("popup__container")&&e.target.classList.contains("popup")&&v(t)},_=function(){d.addEventListener("mousedown",p),d.addEventListener("keydown",m)},y=function(){d.removeEventListener("mousedown",p),d.removeEventListener("keydown",m)};function S(e,t,n){e.value=t?"Сохранение...":n}var b={baseUrl:"https://nomoreparties.co/v1/plus-cohort-8",headers:{authorization:"c88eea69-7eb3-42c3-9092-d5939e2a4a28","Content-Type":"application/json"}},q=function(){for(var e=[],t=0;t<arguments.length;t++)"function"==typeof arguments[t]&&(e[arguments[t].length]=arguments[t]);return function(){return e[arguments.length].apply(this,arguments)}}((function(e,t){return fetch("".concat(b.baseUrl,"/").concat(t),{method:e,headers:b.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log("Ошибка: ".concat(e))}))}),(function(e,t,n){return fetch("".concat(b.baseUrl,"/").concat(t),{method:e,headers:b.headers,body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log("Ошибка: ".concat(e))}))})),h=document.querySelector(".profile__edit-btn"),E=document.querySelector(".popup_edit-profile"),L=E.querySelector(".popup__close-btn"),k=document.forms["profile-form"],g=document.querySelector(".profile"),C=g.querySelector(".profile__name"),x=g.querySelector(".profile__desc"),T=g.querySelector(".profile__avatar"),A=E.querySelector(".button");var w=document.querySelector(".fullscreen-view"),P=w.querySelector(".fullscreen-view__img"),j=w.querySelector(".fullscreen-view__heading"),B=w.querySelector(".popup__close-btn"),U=document.querySelector(".cards .cards__container"),D="";function G(e){U.prepend(e)}function F(e){var t=document.querySelector("#card").content.querySelector(".card").cloneNode(!0),n=t.querySelector(".card__img"),r=t.querySelector(".card__like-btn"),o=t.querySelector(".card__like-count");n.src=e.link,n.alt=e.name,t.querySelector(".card__heading").textContent=e.name,function(e,t,n){e.likes.forEach((function(r){t.textContent=e.likes.length,r.name===D?n.classList.add("card__like-btn_active"):n.classList.remove("card__like-btn_active")}))}(e,o,r),r.addEventListener("click",(function(t){t.target.classList.contains("card__like-btn_active")?(t.target.classList.remove("card__like-btn_active"),q("DELETE","cards/likes/".concat(e._id)).then((function(e){o.textContent=e.likes.length}))):(t.target.classList.add("card__like-btn_active"),q("PUT","cards/likes/".concat(e._id)).then((function(e){o.textContent=e.likes.length})))}));var c=t.querySelector(".card__delete-btn");return"962f4b8fb85fe6328b59968a"===e.owner._id?c.addEventListener("click",(function(t){t.target.closest(".card").remove(),q("DELETE","cards/".concat(e._id))})):c.style.display="none",t.setAttribute("tabindex",0),t.querySelector(".card__img").addEventListener("click",(function(t){var n,r;n=e.link,r=e.name,P.src=n,P.alt=r,j.textContent=r,f(w)})),t}q("GET","users/me").then((function(e){D=e.name}));var H=document.querySelector(".popup_add-place"),I=H.querySelector(".popup__close-btn"),N=document.forms["add-place-form"],O=document.querySelector(".profile__add-btn");var z,J=document.querySelector(".profile__avatar"),M=document.querySelector(".popup_avatar-edit"),K=M.querySelector(".popup__close-btn"),Q=M.querySelector(".button"),R=document.forms["avatar-edit-form"];q("GET","cards").then((function(e){console.log(e),e.reverse().forEach((function(e){G(F(e))}))})),h.addEventListener("click",(function(){f(E),k["profile-name"].value=C.textContent,k["profile-desc"].value=x.textContent,i(k.querySelector(".form__submit"))})),L.addEventListener("click",(function(){u(),v(E)})),k.addEventListener("submit",(function(e){var t="Сохранить";S(A,!0,t),q("PATCH","users/me",{name:k["profile-name"].value,about:k["profile-desc"].value}).then((function(e){C.textContent=e.name,x.textContent=e.about})).finally((function(){return S(A,!1,t)})),u(),v(E)})),O.addEventListener("click",(function(){f(H)})),I.addEventListener("click",(function(){N["place-name"].value="",N["place-url"].value="",u(),v(H)})),N.addEventListener("submit",(function(e){var t=N.querySelector(".form__submit"),n="Создать";S(t,!0,n),q("POST","cards",{link:N["place-url"].value,name:N["place-name"].value}).then((function(e){G(F(e))})).finally((function(){return S(t,!0,n)})),N["place-name"].value="",N["place-url"].value="",i(t),u(),v(H)})),B.addEventListener("click",(function(){v(w)})),e=(z={formSelector:".form",formField:".form__field",inputSelector:".form__text",submitButtonSelector:".form__submit",inactiveButtonClass:"button_inactive",inputErrorClass:"form__text_type_error",errorClass:"form__text-error_active"}).formSelector,t=z.formField,n=z.inputSelector,r=z.submitButtonSelector,o=z.inactiveButtonClass,c=z.inputErrorClass,a=z.errorClass,Array.from(document.querySelectorAll(e)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),s(e)})),q("GET","users/me").then((function(e){C.textContent=e.name,x.textContent=e.about,T.style.backgroundImage="url("+e.avatar+")"})),J.addEventListener("click",(function(){f(M)})),K.addEventListener("click",(function(){R["avatar-url"].value="",u(),v(M)})),R.addEventListener("submit",(function(e){var t="Сохранить";S(Q,!0,t),q("PATCH","users/me/avatar",{avatar:R["avatar-url"].value}).then((function(e){J.style.backgroundImage="url("+e.avatar+")"})).finally((function(){S(Q,!1,t)})),R["avatar-url"].value="",v(M)}))})();